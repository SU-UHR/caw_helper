<?php
/**
 * @file
 */

/**
 * Implements hook_help().
 */
function caw_helper_help($path, $arg) {
  switch ($path) {
    case 'admin/help#caw':
      return '<p>' . t('Please contact your site administrator') . '</p>';
  }
}

/**
 * Implements hook_theme_registry_alter().
 */
function caw_helper_theme_registry_alter(&$theme_registry) {
  if (isset($theme_registry['facetapi_count'])) {
    $theme_registry['facetapi_count']['function'] = "caw_helper_facetapi_count";
  }
}


/**
 * [caw_helper_facetapi_count_alter description]
 * @param  [type] &$vars [description]
 * @return [type]        [description]
 */
function caw_helper_facetapi_count(&$variables) {
  return '<span class="facetapi-count">(' . (int) $variables['count'] . ')</span>';
}

/**
 * Implements hook_init().
 */
function caw_helper_init() {

  $file_path = drupal_get_path('module', 'caw_helper') . "/css/caw_helper.css";
  $conditions = "admin
admin*
node/*/edit
block/*/edit*
block/add*
node/add*
user/*/edit
node/*/delete";

  $css_rules = array();
  $css_rules['rule_conditions'] = $conditions;
  $css_rules['rule_type'] = CSS_INJECTOR_PAGES_NOTLISTED;

  $pass = _css_injector_evaluate_rule($css_rules);
  if ($pass) {
    drupal_add_css($file_path, array('type' => 'file', 'group' => CSS_THEME, 'media' => "all", 'preprocess' => TRUE, 'weight' => 300));
  }

}

/**
 * Check the box if a resource is checked.
 * @param  [type] &$build    [description]
 * @param  [type] &$settings [description]
 * @return [type]            [description]
 */
function caw_helper_facet_items_alter(&$build, &$settings) {
  if ($settings->facet == "type") {
    $fs = isset($_GET['f']) ? $_GET['f'] : array();
    foreach ($fs as $index => $value) {
      if (strpos($value, 'field_s_resource_type') !== FALSE) {
        $build['stanford_resource']["#active"] = 1;
        break;
      }
    }
  }
}

/**
 * Implements hook_views_api().
 */
function caw_helper_views_api() {
  return array(
    'api' => "3.0",
  );
}

/**
 * Implements hook_preprocess().
 */
function caw_helper_preprocess_page(&$vars) {

  // Don't hide the title on node/edit pages. le sigh.
  if (path_is_admin(current_path())) {
    return;
  }

  // If the landing page option to hide title is set to true, hide it.
  if (isset($vars['node']) && $vars['node']->type == "stanford_landing_page") {
    $node = $vars['node'];
    if (isset($node->field_hide_title[LANGUAGE_NONE][0]['value']) && $node->field_hide_title[LANGUAGE_NONE][0]['value'] == "1") {
      drupal_set_title('');
    }
  }
}
